---
layout : single
title:  "[JPA] JQPL ê¸°ë³¸ë¬¸ë²•ê³¼ API   "
categories: JPA
tags:
  - [JPA]

toc: true
toc_sticky: true
 
date: '2022-03-19 00:00:00 +0900'

---


<br>

#### JQPL 

> JPQLì€ SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ì•ŠëŠ”ë‹¤ + JPQLì€ ê²°êµ­ SQLë¡œ ë³€í™˜ëœë‹¤.

#### JQPL ë¬¸ë²•
- SELECT M FROM MEMBER AS M WHERE M.AGE > 18
- ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤.
- JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì•ˆí•œë‹¤.
- ì—”í‹°í‹° ì´ë¦„ ì‚¬ìš©, í…Œì´ë¸”ì´ë¦„ì´ ì•„ë‹˜! (FROM MEMBER ë¶€ë¶„)
- ë³„ì¹­ í•„ìˆ˜ ! ëŒ€ì‹  AS ìƒëµê°€ëŠ¥ 
- ì§‘í•©ê³¼ ì •ë ¬ , GROUP BY , HAVING, ORDER BY ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

#### TypeQuery, Query
- TypeQuery : ë°˜í™˜íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©
- Query : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ë•Œ ì‚¬ìš©

```java
  Member member = new Member();
  member.setUsername("ë„í˜„");
  member.setAge(27);
  em.persist(member);
  //2ë²ˆì§¸ì— íƒ€ì…ì •ë³´(í´ë˜ìŠ¤) ëª…ì‹œ
  TypedQuery<Member> query1 = em.createQuery("select m from Member m ", Member.class);
  TypedQuery<String> query2 = em.createQuery("select m.username from Member m", String.class);
  
  //íƒ€ì… ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŒ 
  Query query3 = em.createQuery("select m.username, m.age from Member m");
```

<BR>

#### ê²°ê³¼ ì¡°íšŒ API

- query.getResultList() : **ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ë•Œ**, ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
   - **ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜í•œë‹¤. nullpointException ê±±ì •ì€ ì•ˆí•´ë„ë¨..**
- query.getSingleResult() : **ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜**, ë‹¨ì¼ ê°ì²´ ë°˜í™˜
  ê²°ê³¼ê°€ ì—†ìœ¼ë©´ : javax.persistence.NoResultException
  ê²°ê³¼ê°€ ì—¬ëŸ¬ê°œë©´ : javax.persistence.NonUniqueResultException

<br>

#### í”„ë¡œì ì…˜
- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
- í”„ë¡œì ì…˜ì˜ ëŒ€ìƒ : ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì…(ìˆ«ì, ë¬¸ìë“± ê¸°ë³¸ë°ì´í„° íƒ€ì…)
- SELECT M FROM MEMBER M -> ì—”í‹°í‹° í”„ë¡œì ì…˜ 
- SELECT M.team FROM MEMBER M -> ì—”í‹°í‹° í”„ë¡œì ì…˜
- SELECT m.address FROM Member m -> ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
- SELECT m.username, m.age FROM Member m -> ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
- Distinctë¡œ ì¤‘ë³µ ì œê±°

<BR>

#### í”„ë¡œì ì…˜ - ì—¬ëŸ¬ ê°’ ì¡°íšŒ
- SELECT m.username, m.age FROM Member m
- 1. Query íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ
- 2. Object[] íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ
- 3. new ëª…ë ¹ì–´ë¡œ ì¡°íšŒ
  - ë‹¨ìˆœê°’ì„ DTOë¡œ ë°”ë¡œì¡°íšŒ
  - SELECT new jpaxxx.jpql.UserDTO(m.username, m.age) FROM Member m
  - íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª… ì…ë ¥
  - ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”í•˜ë‹¤.

<br>

#### í˜ì´ì§• API
- JPAëŠ” í˜ì´ì§•ì„ ë‘ APIë¡œ ì¶”ìƒí™”
- setFirstResult(int startPosition) : ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜ (0ë¶€í„° ì‹œì‘í•¨)
- setMaxResults(int maxResult) : ì¡°íšŒí•  ë°ì´í„° ìˆ˜ 

```java
//í˜ì´ì§• ì¿¼ë¦¬
 String jpql = "select m from Member m order by m.name desc";
 List<Member> resultList = em.createQuery(jpql, Member.class)
 .setFirstResult(10)
 .setMaxResults(20)
 .getResultList();
```

<Br>

#### ì¡°ì¸
- ë‚´ë¶€ ì¡°ì¸ : SELECT m FROM Member m [INNER] JOIN m.team t
- ì™¸ë¶€ ì¡°ì¸ : SELECT m FROM Member m LEFT [OUTER] JOIN m.team t
- ì„¸íƒ€ ì¡°ì¸ : select count(m) from Member m, Team t where m.username = t.name

> ì¡°ì¸ - ON ì ˆ
- ONì ˆì„ í™œìš©í•œ ì¡°ì¸(JPA2.1ë¶€í„° ì§€ì›)
  - 1. ì¡°ì¸ ëŒ€ìƒ í•„í„°ë§
  - 2. ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸(í•˜ì´ë²„ë„¤ì´íŠ¸ 5.1 ë¶€í„°)

> 1. ì¡°ì¸ëŒ€ìƒ í•„í„°ë§
- ì˜ˆ) íšŒì›ê³¼ íŒ€ì„ ì¡°ì¸í•˜ë©´ì„œ, íŒ€ ì´ë¦„ì´ Aì¸ íŒ€ë§Œ ì¡°ì¸í• ë•Œ

```JAVA
//JPQL
SELECT m, t FROM Member m LEFT JOIN m.team t on t.name = 'A'

//SQL
SELECT m.*, t.* FROM
Member m LEFT JOIN Team t ON m.TEAM_ID=t.id and t.name='A'
```

<BR>

> 2. ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ì¡°ì¸
- ì˜ˆ) íšŒì›ì˜ ì´ë¦„ê³¼ íŒ€ì˜ ì´ë¦„ì´ ê°™ì€ ëŒ€ìƒ ì™¸ë¶€ ì¡°ì¸

```JAVA
// JPQL
SELECT m, t FROM
Member m LEFT JOIN Team t on m.username = t.name

// SQL
SELECT m.*, t.* FROM
Member m LEFT JOIN Team t ON m.username = t.name
```

#### ì„œë¸Œ ì¿¼ë¦¬


ğŸ˜„ ì°¸ê³  : ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ì˜ JPA ê¸°ë³¸ ê°•ì˜ ë° êµì¬  

<br>

ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„
<br>

**ê°œì¸ë©”ëª¨** 
