---
layout : single
title:  "[JPA] ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ "
categories: JPA
tags:
  - [JPA]

toc: true
toc_sticky: true
 
date: '2022-03-10 00:00:00 +0900'

---


<br>

#### ëª©í‘œ

- **ê°ì²´ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ê¸°**

- **ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘**

<br>

# ì—°ê´€ ê´€ê³„ ë§¤í•‘ 

- ë°©í–¥ : ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„± : ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤, ì¼ëŒ€ì¼ ,ë‹¤ëŒ€ë‹¤ ì´í•´
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ : ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ì£¼ì¸ì´ í•„ìš”í•˜ë‹¤.

<br>

#### ì—°ê´€ê´€ê³„ê°€ í•„ìš”í•œ ì´ìœ 
- ê°ì²´í•˜ë‚˜ í˜¹ì€ í…Œì´ë¸” í•˜ë‚˜ë¡œ ì„¤ê³„í•˜ê³  ê°œë°œí•  ìˆ˜ ì—†ë‹¤.
- íšŒì›ê³¼ íŒ€ì´ ìˆê³  íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆì„ë•Œ, íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤. 
- ì´ëŸ° ê´€ê³„ë“¤ì„ í‘œí˜„í•˜ê³  ì ìš©í•´ì„œ ê°œë°œí•´ì•¼í•œë‹¤. 

<BR>

> ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§ í•˜ëŠ”ê²ƒ ( ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê°ì²´ ) 


<br>

```java

//íŒ€ ì €ì¥
 Team team = new Team();
 team.setName("TeamA");
 em.persist(team);

 //íšŒì› ì €ì¥
 Member member = new Member();
 member.setName("member1");
 member.setTeamId(team.getId()); //ê°ì²´ì§€í–¥ê³¼ëŠ” ê±°ë¦¬ê°€ìˆìŒ 
 em.persist(member);

//ì¡°íšŒë¥¼ í• ë•Œì—ë„ ì‹ë³„ìë¡œ ë‹¤ì‹œ ì¡°íšŒí•˜ê³  ê·¸ ê°’ì„ Teamì—ì„œ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ í™•ì¸í•´ì•¼í•¨
//ì¡°íšŒê°’
Member findMember = em.find(Member.class , member.getId());

// ì—°ê´€ê´€ê³„ê°€ ì—†ì´ ê°€ì ¸ì˜´
Team findTeam = em.find(Team.class , team.getId());
```
<br>

> ê°ì²´ì§€í–¥ ëª¨ë¸ë§ (ì—°ê´€ê´€ê³„ ì €ì¥ì‹œ)

```java
//íŒ€ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeam(team); // ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •, ì°¸ì¡° ì €ì¥
em.persist(member);

//ì¡°íšŒ 
Member findMember = em.find(Member.class, member.getId());

//ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ ì¡°íšŒ
Team findTeam = findMember.getTeam();

```

<br>

> ì—°ê´€ê´€ê³„ ì €ì¥í•˜ê³  ìˆ˜ì •ì‹œ

<br>

```java
//ìƒˆë¡œìš´ íŒ€B
Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);
//íšŒì› 1ì— ìƒˆë¡œìš´ íŒ€B ì„¤ì •
member.setTeam(teamB);
```


<br>

#### ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„
<br>

- ê°ì²´ ì§€í–¥ ëª¨ë¸ë§ (ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©)
- ê´€ê³„ê°€ ì–´ë–¤ì§€ë‘ ì–´ë–¤ ì»¬ëŸ¼ì„ í†µí•´ ì¡°ì¸í•˜ëŠ”ì§€ ëª…ì‹œí•´ì£¼ë©´ëœë‹¤.



#### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ - ì¤‘ìš” !

- ì–‘ë°©í–¥ ê°ì²´ ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•´ë„ í…Œì´ë¸”ì—” ë³€í™” ì—†ìŒ 
- í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ì—” ì™¸ë˜í‚¤ë¡œ ì„œë¡œì˜ ì—°ê´€ì„ ë‹¤ ì•Œìˆ˜ ìˆì§€ë§Œ
- ê°ì²´ì—ì„  Teamì—ì„œ Memberë¡œ ê°ˆìˆ˜ ì—†ìŒ
- ê·¸ë˜ì„œ List membersë¥¼ ë‘ì–´ì„œ ì–‘ë°©í–¥ìœ¼ë¡œ ë§¤í•‘ì´ ê°€ëŠ¥í•˜ê²Œ í•¨. 

> ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„
- ê°ì²´ì˜ **ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œë‹¤.**
- ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼í•œë‹¤.

<br>

- A- > B (a.getB())
- B- > A (b.getA())

<br>

> í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ê´€ê³„
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤. (ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)


<br>

#### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ (Owner)

<br>

![ì—°ê´€ê´€ê³„1](https://user-images.githubusercontent.com/52389219/157611876-796da2c2-b406-4b9f-a1a0-4b020135465e.PNG)

<br>

> ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™
  > ê°ì²´ì˜ ë‘ ê´€ê³„ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •í•´ì•¼í•¨
  > **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
  > **ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ë‹¤**
  > ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš©X
  > ì£¼ì¸ì´ ì•„ë‹ˆë¼ë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

<br>

> ëˆ„êµ¬ë¥¼ ì£¼ì¸ìœ¼ë¡œ í•´ì•¼í• ê¹Œ?
  > **ì™¸ë˜í‚¤ê°€ ìˆëŠ”ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼**

<br>

#### ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ê°€ì¥ ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜ 
> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•˜ì§€ ì•ŠìŒ 

ì½”ë“œ
```java
  Member member = new Member();
  member.setUsername("member1");
  em.persist(member);

  Team team = new Team();
  team.setName("TeamA");
  team.getMembers().add(member);
    em.persist(team);

  em.flush();
  em.clear();

  tx.commit();
```
- membersëŠ” ì½ê¸°ì „ìš©ì´ë¯€ë¡œ member.setTeam()ì„ í†µí•´ì„œ teamì„ ë„£ì–´ì•¼í•¨ memberì— !

<br>

![ë„ì‚¬ì§„](https://user-images.githubusercontent.com/52389219/157611884-44c8cfd2-e240-46ee-8e85-2c8d8210414e.PNG)

<br>

```java
Member member = new Member();
member.setUsername("member1");

Team team = new Team();
team.setName("TeamA");
em.persist(team);

member.setTeam(team);

em.persist(member);

em.flush();
em.clear();
tx.commit();
```
<br>

> ìœ„ ì½”ë“œì—ì„œ teamì— ê°’ì„ ë„£ì–´ë‘ê³  ì¶”í›„ teamì˜ mappedbyëœ ê²ƒì´ ì•„ë‹Œ member(ì£¼ì¸)ì„í†µí•´ì„œ ê°’ì„ ë„£ì–´ì¤€ë‹¤.

<br>

> í•´ê²°

![ë„í•´ê²°](https://user-images.githubusercontent.com/52389219/157612499-81ce2400-9a35-4457-88ff-713778dfa704.PNG)

<br>

#### ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì—°ê´€ê´€ê³„ì‹œ ì–‘ìª½ì— ê°’ ì„¸íŒ…ì€ ëª¨ë‘ í•´ì£¼ì–´ì•¼í•œë‹¤.
- ìˆœìˆ˜ ê°ì²´ ìƒíƒœë¥¼ ê³ ë ¤í•´ì„œ í•­ìƒ ì–‘ìª½ì— ê°’ì„ ì„¤ì •í•´ì•¼í•œë‹¤.
- ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì
- ì–‘ë°©í–¥ ë§¤ì‹œí•‘ì— ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì ex) toString(), lombok, JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì‹¤ë¬´ì—ì„  controllerì—ì„œ ì—”í‹°í‹°ë¡œ ë°˜í™˜ NO! 

<BR>

```JAVA
//ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ
//Member í´ë˜ìŠ¤
public void setTeam(Team team){
  this.team = team;
  team.getMembers().add(this);
  //this -> Member ì¸ìŠ¤í„´ìŠ¤ 
}

```

<BR>

#### ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬
- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ
- ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒ(ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰) ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒ ë¿
- JPQLì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ìŒ 
- ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•´ë„ ë¨ (í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ì•ŠìŒ)


<BR>

ğŸ˜„ ì°¸ê³  : ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ì˜ JPA ê¸°ë³¸ ê°•ì˜ ë° êµì¬ 

<br>

ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„
<br>

**ê°œì¸ë©”ëª¨** 
